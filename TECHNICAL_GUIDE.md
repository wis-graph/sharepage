# 📖 SharePage 기술 가이드 및 아키텍처 명세

본 문서는 `sharepage` 웹사이트 템플릿의 작동 원리와 구조를 설명합니다. 특히 옵시디언 플러그인을 개발하거나 유지보수하는 개발자(또는 AI 에이전트)를 위한 핵심 정보를 담고 있습니다.

## 1. 프로젝트 개요
SharePage는 옵시디언의 마크다운 노트를 웹사이트로 변환하여 배포하는 **정적 웹사이트 템플릿**입니다. 
- **핵심 철학**: 서버 없이 GitHub Pages만으로 구동되며, SEO와 SNS 미리보기(Open Graph)를 완벽하게 지원합니다.
- **주요 기술**: 바닐라 JS, CSS3, Node.js (빌드 스크립트).

## 2. 핵심 아키텍처: "Hybrid Static/Dynamic"
SharePage는 독특한 하이브리드 방식을 사용합니다.
1.  **빌드 타임 (`sync.js`)**: 마크다운 노트를 분석하여 각 노트에 해당하는 **개별 HTML 파일**을 생성합니다. (주요 목적: SEO 및 SNS 미리보기 지원)
2.  **런타임 (`js/app.js`)**: 사용자가 브라우저로 접속하면 클라이언트 사이드 JS가 URL을 분석하여 실제 마크다운 데이터를 동적으로 렌더링합니다.

## 3. 마크다운-HTML 동기화 (`scripts/sync.js`)
이 스크립트는 프로젝트의 "엔진" 역할을 하며, 플러그인이 파일을 푸시한 후 GitHub Actions에 의해 실행됩니다.

### 🛠 담당 역할
- **메타데이터 추출**: 마크다운의 YAML Frontmatter와 본문을 분석하여 제목(Title), 설명(Description), 대표 이미지(Thumbnail)를 추출합니다.
- **HTML 템플릿 주입**: `src/index.html` 마스터 템플릿을 읽어 플레이스홀더(`{{TITLE}}` 등)를 실제 데이터로 치환합니다.
- **버전 관리 (Cache Busting)**: 빌드 시점의 타임스탬프를 생성하여 모든 JS/CSS 경로에 `?v=12345` 형태의 쿼리 파라미터를 강제 주입합니다.
- **404.html 생성**: GitHub Pages의 SPA 라우팅을 위해 `index.html`을 복사하여 `404.html`을 생성합니다.
- **인덱싱**: `posts/file_index.json`을 생성하여 클라이언트가 대시보드에서 불러올 노트 목록을 제공합니다.

### 📋 생성물
- `/index.html`: 메인 대시보드 페이지.
- `/404.html`: 딥 링크(Deep Link) 지원용 페이지.
- `/posts/*.html`: 각 노트별 SEO 최적화용 개별 HTML 파일.
- `/posts/file_index.json`: 전체 노트 메타데이터 목록.

## 4. 문서 타입별 프로세서 (`scripts/processors/`)
SharePage는 문서의 성격에 따라 메타데이터 추출 로직을 가변적으로 적용하는 **전용 프로세서 구조**를 가집니다.

- **작동 원리**: 마크다운의 `type` 또는 `source_type` 필드를 감지하여 적절한 프로세서를 호출합니다.
- **기본 프로세서 (`standard.js`)**: 가장 범용적인 마크다운 변환 로직을 담당합니다.
- **특화 프로세서 (예: `youtube.js`)**: 특정 콘텐츠(유튜브 등)에 최적화된 로직(썸네일 자동 추출, 영상 타입 지정 등)을 수행합니다.
- **확장 방법**: `scripts/processors/` 디렉토리에 새로운 `.js` 파일을 생성하고 `sync.js`의 `processors` 객체에 등록함으로써 손쉽게 새로운 문서 타입을 지원할 수 있습니다.

## 5. 플레이스홀더 시스템
`src/index.html` 파일은 원본 템플릿으로 사용되며, 다음과 같은 플레이스홀더를 포함합니다.
- `{{TITLE}}`: 페이지 제목 및 OG 제목.
- `{{DESCRIPTION}}`: 페이지 설명 및 OG 설명.
- `{{OG_IMAGE}}`: SNS 공유 시 노출될 썸네일 경로.
- `{{PAGE_URL}}`: 해당 페이지의 절대 경로.
- `{{OG_TYPE}}`: 콘텐츠 타입 (일반 노트: `website`, 유튜브 기반 노트: `video.other`).

## 6. 클라이언트 사이드 렌더링 (JS/CSS)
- **라우팅 (`js/core/router.js`)**: 브라우저의 전역 경로와 해시를 감시하여 `Dashboard` 모드와 `Document` 모드를 전환합니다.
- **스타일 (`css/bundle.css`)**: 모든 CSS 파일을 하나로 번들링하여 전송 성능을 극대화합니다.
- **이미지 처리**: 썸네일이 없을 경우 제목을 기반으로 한 텍스트 썸네일을 동적으로 생성합니다.

## 7. GitHub Actions 배포 흐름 (`deploy.yml`)
1.  사용자(또는 플러그인)가 `notes/` 폴더에 마크다운 파일을 푸시함.
2.  GitHub Actions가 트리거되어 `node scripts/sync.js`를 실행함.
3.  생성된 HTML 파일들과 `bundle.css`를 다시 `main` 브랜치에 커밋함 (`[skip ci]` 태그 사용).
4.  GitHub Pages가 최종 결과물을 전 세계에 배포함.

---

## 🚀 플러그인 개발자를 위한 가이드

플러그인이 SharePage와 연동될 때 준수해야 할 사항은 다음과 같습니다.

1.  **데이터 저장 위치**: 사용자의 모든 마크다운 파일은 `/notes/` 디렉토리에 저장되어야 합니다.
2.  **이미지 저장 위치**: 노트에서 사용하는 이미지는 `/images/` 디렉토리에 저장되어야 합니다.
3.  **Frontmatter 표준**:
    - `title`: 웹사이트에 보일 제목.
    - `description`: 검색 결과 및 공유 시 보일 요약.
    - `thumbnail`: 썸네일 이미지 파일명 또는 유튜브 URL.
    - `tags`: 대시보드 필터링을 위한 태그 목록.
4.  **푸시 대상**: 사용자가 설정한 GitHub 레포지토리의 `main` 브랜치로 마크다운 파일을 직접 푸시하면 됩니다. 그 이후의 HTML 변환과 배포는 SharePage가 자동으로 수행합니다.

---
**최종 수정일**: 2026-02-14
**작성자**: Antigravity (Advanced Agentic Coding AI)
